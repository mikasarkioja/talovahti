generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model HousingCompany {
  id                     String               @id @default(cuid())
  businessId             String               @unique
  name                   String
  address                String
  city                   String
  postalCode             String
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  constructionYear       Int?
  accountingApiKey       String?
  bic                    String?
  iban                   String?
  financeFeePerShare     Decimal              @default(0.00)
  maintenanceFeePerShare Decimal              @default(4.50)
  totalSqm               Float?
  healthScore            Int?
  realTimeCash           Float?
  unpaidInvoicesCount    Int?
  healthScoreAdmin       Int?
  healthScoreFinancial   Int?
  healthScoreTechnical   Int?
  htjId                  String?
  annualTasks            AnnualTask[]
  fiscalConfig           FiscalConfiguration?
  strategicGoals         StrategicGoal[]
  apartments             Apartment[]
  boardProfile           BoardProfile?
  budgetLines            BudgetLineItem[]
  buildingComponents     BuildingComponent[]
  documentOrders         DocumentOrder[]
  features               FeatureAccess[]
  scenarios              FinancialScenario[]
  financialStatements    FinancialStatement[]
  gdprLogs               GDPRLog[]
  healthHistory          HealthHistory[]
  htjShadowRecords       HTJ_ShadowRecord[]
  htjSyncLogs            HTJ_SyncLog[]
  initiatives            Initiative[]
  investmentGrades       InvestmentGrade[]
  investments            InvestmentOption[]
  invoices               Invoice[]
  loanApplications       LoanApplication[]
  documents              MeetingDocument[]
  statutoryDocuments     StatutoryDocument[]
  meetings               Meeting[]
  mmlSyncLogs            MMLSyncLog[]
  monthlyFees            MonthlyFee[]
  observations           Observation[]
  orders                 Order[]
  projects               Project[]
  renovations            Renovation[]
  resources              Resource[]
  partners               ServicePartner[]
  shareholders           Shareholder[]
  subscription           Subscription?
  surveys                Survey[]
  tickets                Ticket[]
  users                  User[]
  utilityPrices          UtilityPrice[]
  vendorRules            VendorRule[]
  volunteerTasks         VolunteerTask[]

  @@index([businessId])
  @@map("housing_companies")
}

model Apartment {
  id               String           @id @default(cuid())
  housingCompanyId String
  apartmentNumber  String
  floor            Int?
  area             Decimal?
  sharesStart      Int
  sharesEnd        Int
  shareCount       Int
  waterFeeAdvance  Decimal          @default(0)
  elecFeeAdvance   Decimal          @default(0)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  attributes       Json?
  housingCompany   HousingCompany   @relation(fields: [housingCompanyId], references: [id])
  leakAlerts       LeakAlert[]
  meters           Meter[]
  fees             MonthlyFee[]
  surveyResponses  SurveyResponse[]
  tickets          Ticket[]
  users            User[]
  votes            Vote[]

  @@unique([housingCompanyId, apartmentNumber])
  @@index([housingCompanyId])
  @@map("apartments")
}

model User {
  id                      String              @id @default(cuid())
  email                   String              @unique
  name                    String?
  housingCompanyId        String
  apartmentId             String?
  role                    UserRole            @default(RESIDENT)
  password                String?
  canApproveFinance       Boolean             @default(false)
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @updatedAt
  consentVersion          String?
  deletedAt               DateTime?
  language                String              @default("fi")
  notificationPreferences Json?
  phone                   String?
  apartmentNumber         String?
  expertId                String?
  vendorId                String?
  shareholderId           String?
  xp                      Int                 @default(0)
  renovations             Renovation[]
  auditLogs               AuditLog[]
  bookings                Booking[]
  comments                Comment[]
  documentOrders          DocumentOrder[]
  gdprLogs                GDPRLog[]
  supportedInitiatives    InitiativeSupport[]
  initiatives             Initiative[]
  approvedInvoices        Invoice[]
  observations            Observation[]
  orders                  Order[]
  pollVotes               PollVote[]
  surveyResponses         SurveyResponse[]
  createdTickets          Ticket[]
  apartment               Apartment?          @relation(fields: [apartmentId], references: [id])
  expert                  Expert?             @relation(fields: [expertId], references: [id])
  housingCompany          HousingCompany      @relation(fields: [housingCompanyId], references: [id])
  vendor                  Vendor?             @relation(fields: [vendorId], references: [id])
  volunteerTasks          VolunteerTask[]
  votes                   Vote[]
  wallet                  Wallet?

  @@index([housingCompanyId])
  @@index([apartmentId])
  @@map("users")
}

model BoardProfile {
  id               String         @id @default(cuid())
  housingCompanyId String         @unique
  totalXP          Int            @default(0)
  level            Int            @default(1)
  achievements     Json?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@map("board_profiles")
}

model HealthHistory {
  id               String         @id @default(cuid())
  housingCompanyId String
  score            Int
  technicalScore   Int
  financialScore   Int
  timestamp        DateTime       @default(now())
  adminScore       Int?
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId, timestamp])
  @@map("health_history")
}

model Subscription {
  id               String             @id @default(cuid())
  housingCompanyId String             @unique
  plan             SubscriptionPlan   @default(BASIC)
  monthlyPrice     Float              @default(0)
  status           SubscriptionStatus @default(ACTIVE)
  expiresAt        DateTime?
  nextBillingDate  DateTime?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  housingCompany   HousingCompany     @relation(fields: [housingCompanyId], references: [id])

  @@map("subscriptions")
}

model FeatureAccess {
  id               String         @id @default(cuid())
  key              String
  name             String
  price            Float
  isEnabled        Boolean        @default(false)
  housingCompanyId String
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@unique([housingCompanyId, key])
  @@map("feature_access")
}

model Order {
  id                String             @id @default(cuid())
  userId            String
  housingCompanyId  String
  type              OrderType
  amount            Float
  platformRevenue   Float              @default(0)
  status            OrderStatus        @default(PENDING)
  metadata          String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  housingCompany    HousingCompany     @relation(fields: [housingCompanyId], references: [id])
  user              User               @relation(fields: [userId], references: [id])
  stripeTransaction StripeTransaction?

  @@index([userId])
  @@index([housingCompanyId])
  @@map("orders")
}

model Ticket {
  id                  String         @id @default(cuid())
  title               String
  description         String
  status              TicketStatus   @default(OPEN)
  priority            TicketPriority @default(MEDIUM)
  type                TicketType     @default(MAINTENANCE)
  supervisor          String?
  housingCompanyId    String
  apartmentId         String?
  createdById         String
  sentToMaintenanceAt DateTime?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  observationId       String?        @unique
  unitIdentifier      String?
  imageUrl            String?
  accessInfo          String?
  huoltoNotes         String?
  isPublic            Boolean        @default(false)
  triageLevel         TriageLevel    @default(ROUTINE)
  category            TicketCategory @default(MAINTENANCE)
  apartment           Apartment?     @relation(fields: [apartmentId], references: [id])
  createdBy           User           @relation(fields: [createdById], references: [id])
  housingCompany      HousingCompany @relation(fields: [housingCompanyId], references: [id])
  observation         Observation?   @relation(fields: [observationId], references: [id])

  @@index([housingCompanyId, status])
  @@index([createdById])
  @@index([category, triageLevel])
  @@map("tickets")
}

model Renovation {
  id               String             @id @default(cuid())
  component        String
  yearDone         Int?
  plannedYear      Int?
  cost             Float?             @default(0)
  expectedLifeSpan Int?               @default(0)
  description      String?
  status           RenovationStatus   @default(COMPLETED)
  category         RenovationCategory @default(SURFACE)
  contractorInfo   String?
  schedule         String?
  triageStatus     RenovationTriageStatus @default(PENDING)
  userId           String?
  housingCompanyId String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  assessments      ExpertAssessment[]
  housingCompany   HousingCompany     @relation(fields: [housingCompanyId], references: [id])
  user             User?              @relation(fields: [userId], references: [id])

  @@index([housingCompanyId])
  @@index([userId])
  @@map("renovations")
}

model Observation {
  id               String            @id @default(cuid())
  component        String
  description      String
  imageUrl         String?
  status           ObservationStatus @default(OPEN)
  location         String?
  userId           String
  housingCompanyId String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  boardSummary     String?
  projectId        String?           @unique
  severityGrade    Int?
  technicalVerdict String?
  vendorId         String?
  assessment       ExpertAssessment?
  housingCompany   HousingCompany    @relation(fields: [housingCompanyId], references: [id])
  project          Project?          @relation("ObservationToProject", fields: [projectId], references: [id])
  user             User              @relation(fields: [userId], references: [id])
  vendor           Vendor?           @relation(fields: [vendorId], references: [id])
  ticket           Ticket?

  @@index([housingCompanyId])
  @@index([userId])
  @@map("observations")
}

model ExpertAssessment {
  id               String           @id @default(cuid())
  observationId    String           @unique
  renovationId     String?
  severityGrade    Int
  technicalVerdict String
  recommendedYear  Int?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  observation      Observation      @relation(fields: [observationId], references: [id])
  renovation       Renovation?      @relation(fields: [renovationId], references: [id])
  options          SolutionOption[]

  @@map("expert_assessments")
}

model SolutionOption {
  id                String           @id @default(cuid())
  assessmentId      String
  title             String
  description       String
  estimatedCost     Float
  lifeSpanExtension Int
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  assessment        ExpertAssessment @relation(fields: [assessmentId], references: [id])

  @@map("solution_options")
}

model BudgetLineItem {
  id               String         @id @default(cuid())
  category         BudgetCategory
  budgetedAmount   Decimal
  actualSpent      Decimal
  year             Int
  housingCompanyId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId, year])
  @@map("budget_line_items")
}

model Invoice {
  id               String         @id @default(cuid())
  externalId       String?
  yTunnus          String?
  vendorName       String
  description      String?
  amount           Decimal
  dueDate          DateTime
  status           InvoiceStatus  @default(PENDING)
  category         BudgetCategory
  projectId        String?
  housingCompanyId String
  approvedById     String?
  imageUrl         String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  approvedBy       User?          @relation(fields: [approvedById], references: [id])
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])
  project          Project?       @relation(fields: [projectId], references: [id])

  @@index([housingCompanyId, status])
  @@index([projectId])
  @@map("invoices")
}

model VendorRule {
  id               String         @id @default(cuid())
  yTunnus          String?
  vendorName       String?
  category         BudgetCategory
  housingCompanyId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@unique([housingCompanyId, yTunnus])
  @@map("vendor_rules")
}

model InvestmentOption {
  id               String         @id @default(cuid())
  title            String
  type             InvestmentType
  initialCost      Decimal
  annualSavings    Decimal
  lifespan         Int
  energySavedKwh   Int
  housingCompanyId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("investment_options")
}

model Project {
  id               String               @id @default(cuid())
  title            String
  type             String
  projectType      ProjectType?
  status           ProjectStatus        @default(DIAGNOSIS)
  estimatedCost    Float?
  energySavingsEst Float?
  housingCompanyId String
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  description      String?
  observationId    String?              @unique
  signatureStatus  SignatureStatus?
  signatureUuid    String?              @unique
  warrantyEndDate  DateTime?
  bids             Bid[]
  updates          BuildingUpdate[]
  changeOrders     ChangeOrder[]
  scenarios        FinancialScenario[]
  invoices         Invoice[]
  contract         LegalContract?
  loanApplications LoanApplication[]
  milestones       Milestone[]
  observation      Observation?         @relation("ObservationToProject")
  accessTokens     ProjectAccessToken[]
  housingCompany   HousingCompany       @relation(fields: [housingCompanyId], references: [id])
  siteReports      SiteReport[]
  tenders          Tender[]

  @@index([housingCompanyId, status])
  @@map("projects")
}

model BuildingUpdate {
  id        String     @id @default(cuid())
  projectId String
  title     String
  content   String
  type      UpdateType
  createdAt DateTime   @default(now())
  project   Project    @relation(fields: [projectId], references: [id])

  @@index([projectId, createdAt])
  @@map("building_updates")
}

model Poll {
  id             String       @id @default(cuid())
  title          String
  description    String
  type           PollType
  expiresAt      DateTime
  resultsVisible Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  options        PollOption[]
  votes          PollVote[]

  @@index([expiresAt])
  @@map("polls")
}

model PollOption {
  id            String     @id @default(cuid())
  pollId        String
  label         String
  vastikeImpact Float
  poll          Poll       @relation(fields: [pollId], references: [id])
  votes         PollVote[]

  @@index([pollId])
  @@map("poll_options")
}

model PollVote {
  id        String     @id @default(cuid())
  pollId    String
  userId    String
  optionId  String
  weight    Float
  createdAt DateTime   @default(now())
  option    PollOption @relation(fields: [optionId], references: [id])
  poll      Poll       @relation(fields: [pollId], references: [id])
  user      User       @relation(fields: [userId], references: [id])

  @@unique([pollId, userId])
  @@index([pollId])
  @@index([userId])
  @@map("poll_votes")
}

model Tender {
  id                        String       @id @default(cuid())
  projectId                 String
  type                      TenderType
  status                    TenderStatus @default(OPEN)
  createdAt                 DateTime     @default(now())
  updatedAt                 DateTime     @updatedAt
  expertRecommendationId    String?
  expertRecommendationReason String?
  aiAnalysisSummary          String?
  bids                      TenderBid[]
  project                   Project      @relation(fields: [projectId], references: [id])

  @@index([projectId])
  @@map("tenders")
}

model TenderBid {
  id                String   @id @default(cuid())
  tenderId          String
  companyName       String
  price             Float
  startDate         DateTime
  endDate           DateTime
  durationDays      Int?
  creditRating      String
  residentRating    Float?
  riskScore         Float?
  warrantyYears     Int?
  status            String   @default("RECEIVED")
  siteVisitsPerWeek Int?
  livePhotosEnabled Boolean  @default(false)
  notes             String?
  pdfUrl            String?
  isWinner          Boolean  @default(false)
  supervisorRating  Int?
  supervisorComments String?
  aiScore            Float?
  aiRiskNote         String?
  stripeCommission   Float?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tender            Tender   @relation(fields: [tenderId], references: [id])

  @@index([tenderId])
  @@map("tender_bids")
}

model Vendor {
  id           String               @id @default(cuid())
  name         String
  category     String
  serviceArea  String[]
  email        String?              @unique
  bids         Bid[]
  observations Observation[]
  accessTokens ProjectAccessToken[]
  users        User[]

  @@map("vendors")
}

model Bid {
  id        String    @id @default(cuid())
  startDate DateTime
  notes     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  amount    Float
  projectId String
  vendorId  String
  status    BidStatus @default(PENDING)
  project   Project   @relation(fields: [projectId], references: [id])
  vendor    Vendor    @relation(fields: [vendorId], references: [id])

  @@index([vendorId])
  @@index([projectId])
  @@map("bids")
}

model ProjectAccessToken {
  id        String    @id @default(cuid())
  token     String    @unique
  projectId String
  vendorId  String
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  project   Project   @relation(fields: [projectId], references: [id])
  vendor    Vendor    @relation(fields: [vendorId], references: [id])

  @@index([token])
  @@map("project_access_tokens")
}

model SiteReport {
  id        String   @id @default(cuid())
  projectId String
  authorId  String
  content   String
  imageUrl  String?
  timestamp DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id])

  @@index([projectId])
  @@map("site_reports")
}

model ChangeOrder {
  id         String            @id @default(cuid())
  projectId  String
  title      String
  costImpact Float
  status     ChangeOrderStatus @default(PENDING)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  project    Project           @relation(fields: [projectId], references: [id])

  @@index([projectId])
  @@map("change_orders")
}

model MMLSyncLog {
  id               String         @id @default(cuid())
  housingCompanyId String
  status           String
  recordCount      Int
  timestamp        DateTime       @default(now())
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("mml_sync_logs")
}

model HTJ_ShadowRecord {
  id               String         @id @default(cuid())
  housingCompanyId String
  endpoint         String
  businessId       String
  rawResponse      Json
  recordType       String
  syncedAt         DateTime       @default(now())
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@unique([housingCompanyId, endpoint, businessId])
  @@index([housingCompanyId])
  @@index([businessId])
  @@map("htj_shadow_records")
}

model HTJ_SyncLog {
  id                String         @id @default(cuid())
  housingCompanyId  String
  boardMemberId     String?
  operation         String
  status            String
  recordCount       Int            @default(0)
  piiFieldsAccessed String[]
  errorMessage      String?
  metadata          Json?
  timestamp         DateTime       @default(now())
  housingCompany    HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@index([boardMemberId])
  @@index([timestamp])
  @@map("htj_sync_logs")
}

model DocumentOrder {
  id               String         @id @default(cuid())
  userId           String
  housingCompanyId String
  type             DocumentType
  amount           Float
  status           OrderStatus    @default(PENDING)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])
  user             User           @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([housingCompanyId])
  @@map("document_orders")
}

model Initiative {
  id               String              @id @default(cuid())
  title            String
  description      String
  affectedArea     String?
  housingCompanyId String
  meetingId        String?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  requiredSupport  Int                 @default(10)
  votingEndsAt     DateTime?
  status           GovernanceStatus    @default(DRAFT)
  userId           String
  comments         Comment[]
  supporters       InitiativeSupport[]
  housingCompany   HousingCompany      @relation(fields: [housingCompanyId], references: [id])
  meeting          Meeting?            @relation(fields: [meetingId], references: [id])
  user             User                @relation(fields: [userId], references: [id])
  votes            Vote[]

  @@index([housingCompanyId, status])
  @@map("initiatives")
}

model InitiativeSupport {
  id           String     @id @default(cuid())
  initiativeId String
  userId       String
  createdAt    DateTime   @default(now())
  initiative   Initiative @relation(fields: [initiativeId], references: [id])
  user         User       @relation(fields: [userId], references: [id])

  @@unique([initiativeId, userId])
  @@map("initiative_supports")
}

model Comment {
  id           String     @id @default(cuid())
  text         String
  initiativeId String
  userId       String
  createdAt    DateTime   @default(now())
  initiative   Initiative @relation(fields: [initiativeId], references: [id])
  user         User       @relation(fields: [userId], references: [id])

  @@index([initiativeId])
  @@map("comments")
}

model Vote {
  id           String     @id @default(cuid())
  userId       String
  initiativeId String
  choice       VoteChoice
  shares       Int
  timestamp    DateTime   @default(now())
  apartmentId  String
  apartment    Apartment  @relation(fields: [apartmentId], references: [id])
  initiative   Initiative @relation(fields: [initiativeId], references: [id])
  user         User       @relation(fields: [userId], references: [id])

  @@unique([initiativeId, apartmentId])
  @@index([initiativeId])
  @@index([apartmentId])
  @@map("votes")
}

model Meeting {
  id               String           @id @default(cuid())
  title            String
  type             MeetingType
  date             DateTime
  housingCompanyId String
  chairmanId       String?
  secretaryId      String?
  scrutineerIds    String[]
  minutesContent   String?
  signatureStatus  SignatureStatus  @default(PENDING)
  signedUrl        String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  status           GovernanceStatus @default(OPEN_FOR_SUPPORT)
  initiatives      Initiative[]
  housingCompany   HousingCompany   @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId, date])
  @@map("meetings")
}

model MeetingDocument {
  id               String         @id @default(cuid())
  title            String
  type             MeetingType
  date             DateTime
  year             Int
  url              String
  aiSummary        String?
  housingCompanyId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId, year])
  @@map("meeting_documents")
}

model StatutoryDocument {
  id               String         @id @default(cuid())
  title            String
  fileUrl          String
  category         String // e.g., "Yhtiöjärjestys", "Osakasluettelo", "Päätösasiakirja"
  isPermanent      Boolean        @default(true)
  metadata         Json?
  housingCompanyId String
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  @@index([housingCompanyId, category])
  @@map("statutory_documents")
}

model Survey {
  id               String           @id @default(cuid())
  housingCompanyId String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  responses        SurveyResponse[]
  housingCompany   HousingCompany   @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("surveys")
}

model SurveyResponse {
  id          String     @id @default(cuid())
  surveyId    String
  userId      String
  apartmentId String?
  createdAt   DateTime   @default(now())
  apartment   Apartment? @relation(fields: [apartmentId], references: [id])
  survey      Survey     @relation(fields: [surveyId], references: [id])
  user        User       @relation(fields: [userId], references: [id])

  @@index([surveyId])
  @@map("survey_responses")
}

model Meter {
  id              String    @id @default(cuid())
  apartmentId     String
  type            MeterType
  serialNumber    String
  lastReading     Decimal
  lastReadingDate DateTime
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  apartment       Apartment @relation(fields: [apartmentId], references: [id])
  readings        Reading[]

  @@index([apartmentId])
  @@map("meters")
}

model Reading {
  id        String   @id @default(cuid())
  meterId   String
  value     Decimal
  date      DateTime
  isManual  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  meter     Meter    @relation(fields: [meterId], references: [id])

  @@index([meterId, date])
  @@map("readings")
}

model UtilityPrice {
  id               String         @id @default(cuid())
  housingCompanyId String
  type             MeterType
  pricePerUnit     Decimal
  validFrom        DateTime
  currency         String         @default("EUR")
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("utility_prices")
}

model LeakAlert {
  id                String       @id @default(cuid())
  apartmentId       String
  severity          LeakSeverity
  status            LeakStatus   @default(ACTIVE)
  triggeredBy       LeakTrigger
  detectionMetadata String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  apartment         Apartment    @relation(fields: [apartmentId], references: [id])

  @@index([apartmentId, status])
  @@index([createdAt])
  @@map("leak_alerts")
}

model ServicePartner {
  id               String          @id @default(cuid())
  name             String
  yTunnus          String?
  category         PartnerCategory
  rating           Float           @default(0)
  verified         Boolean         @default(false)
  housingCompanyId String
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  housingCompany   HousingCompany  @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId, category])
  @@map("service_partners")
}

model VolunteerTask {
  id                 String             @id @default(cuid())
  title              String
  description        String
  housingCompanyId   String
  userId             String
  status             ResidentTaskStatus @default(OPEN)
  compensationAmount Float
  rewardType         RewardType         @default(HOITOVASTIKE_CREDIT)
  proofImageUrl      String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  housingCompany     HousingCompany     @relation(fields: [housingCompanyId], references: [id])
  user               User               @relation(fields: [userId], references: [id])

  @@index([housingCompanyId, status])
  @@map("volunteer_tasks")
}

model Resource {
  id                String         @id @default(cuid())
  name              String
  type              ResourceType
  priceEuro         Float          @default(0)
  priceKarma        Int            @default(0)
  icon              String?
  bufferTimeMinutes Int            @default(0)
  powerRatingKw     Float          @default(0)
  housingCompanyId  String
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  bookings          Booking[]
  powerEvents       PowerEvent[]
  housingCompany    HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("resources")
}

model Booking {
  id           String        @id @default(cuid())
  resourceId   String
  userId       String
  startTime    DateTime
  endTime      DateTime
  paymentType  PaymentType
  status       BookingStatus @default(CONFIRMED)
  accessCode   String?
  isPreheating Boolean       @default(false)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  resource     Resource      @relation(fields: [resourceId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  powerEvents  PowerEvent[]

  @@index([resourceId, startTime])
  @@index([userId])
  @@map("bookings")
}

model PowerEvent {
  id              String   @id @default(cuid())
  resourceId      String
  bookingId       String?
  timestamp       DateTime @default(now())
  eventType       String
  durationMinutes Int?
  kwhEstimated    Float?
  costEstimated   Float?
  booking         Booking? @relation(fields: [bookingId], references: [id])
  resource        Resource @relation(fields: [resourceId], references: [id])

  @@index([resourceId, timestamp])
  @@map("power_events")
}

model Wallet {
  id           String   @id @default(cuid())
  userId       String   @unique
  euroBalance  Float    @default(0)
  karmaBalance Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])

  @@map("wallets")
}

model LegalContract {
  id             String         @id @default(cuid())
  projectId      String         @unique
  contractorId   String
  contractorName String
  status         ContractStatus @default(DRAFT)
  signedAt       DateTime?
  fileUrl        String?
  content        String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  project        Project        @relation(fields: [projectId], references: [id])
  milestones     Milestone[]

  @@map("legal_contracts")
}

model Milestone {
  id         String          @id @default(cuid())
  contractId String?
  title      String
  amount     Float
  dueDate    DateTime
  isApproved Boolean         @default(false)
  approvedAt DateTime?
  approvedBy String?
  isPaid     Boolean         @default(false)
  paidAt     DateTime?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  projectId  String
  status     MilestoneStatus @default(PENDING)
  contract   LegalContract?  @relation(fields: [contractId], references: [id])
  project    Project         @relation(fields: [projectId], references: [id])

  @@index([projectId])
  @@index([contractId])
  @@map("milestones")
}

model FinancialStatement {
  id               String         @id @default(cuid())
  housingCompanyId String
  year             Int
  revenue          Float
  maintenanceFees  Float
  loansTotal       Float
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("financial_statements")
}

model Shareholder {
  id               String         @id @default(cuid())
  housingCompanyId String
  name             String
  businessId       String?
  shareCount       Int
  isInstitutional  Boolean        @default(false)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  deletedAt        DateTime?
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("shareholders")
}

model LoanApplication {
  id               String         @id @default(cuid())
  housingCompanyId String
  amount           Float
  purpose          String
  status           LoanStatus     @default(DRAFT)
  riskAnalysis     String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  bankName         String?
  collateralType   String?
  offerMargin      Float?
  projectId        String?
  repaymentTerm    Int?
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])
  project          Project?       @relation(fields: [projectId], references: [id])

  @@index([housingCompanyId])
  @@index([projectId])
  @@map("loan_applications")
}

model CostBenchmark {
  id                        String   @id @default(cuid())
  category                  String   @unique
  unitPriceM2               Float
  expectedLifeYears         Int
  technicalDepreciationRate Float
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime @updatedAt

  @@map("cost_benchmarks")
}

model FinancialScenario {
  id                 String         @id @default(cuid())
  housingCompanyId   String
  title              String
  totalLoanAmount    Float
  interestRate       Float
  termYears          Int
  monthlyImpactPerM2 Float
  isBaseline         Boolean        @default(false)
  metadata           String?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  projectId          String?
  housingCompany     HousingCompany @relation(fields: [housingCompanyId], references: [id])
  project            Project?       @relation(fields: [projectId], references: [id])

  @@index([housingCompanyId])
  @@map("financial_scenarios")
}

model InvestmentGrade {
  id               String         @id @default(cuid())
  housingCompanyId String
  score            Float
  grade            String
  pillarScores     String
  updatedAt        DateTime       @updatedAt
  createdAt        DateTime       @default(now())
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("investment_grades")
}

model GDPRLog {
  id               String          @id @default(cuid())
  actorId          String
  action           String
  details          String?
  ipAddress        String?
  housingCompanyId String?
  timestamp        DateTime        @default(now())
  reason           String?
  resource         String?
  impactScore      Int?
  targetEntity     String?
  actor            User            @relation(fields: [actorId], references: [id])
  housingCompany   HousingCompany? @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@index([actorId])
  @@map("gdpr_logs")
}

model AuditLog {
  id          String   @id @default(cuid())
  action      String
  userId      String
  targetId    String?
  metadata    Json?
  timestamp   DateTime @default(now())
  impactScore Int?
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([targetId])
  @@map("audit_logs")
}

model MonthlyFee {
  id               String         @id @default(cuid())
  housingCompanyId String
  apartmentId      String
  referenceNumber  String
  amount           Decimal
  period           DateTime
  status           InvoiceStatus  @default(PENDING)
  breakdown        Json?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  dueDate          DateTime
  apartment        Apartment      @relation(fields: [apartmentId], references: [id])
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId, period])
  @@index([apartmentId])
  @@map("monthly_fees")
}

model FiscalConfiguration {
  id               String         @id @default(cuid())
  startMonth       Int            @default(1)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompanyId String         @unique
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])
}

model AnnualTask {
  id               String         @id @default(cuid())
  title            String
  category         TaskCategory
  quarter          FiscalQuarter
  isStatutory      Boolean        @default(false)
  description      String?
  meshId           String?
  completedAt      DateTime?
  deadline         DateTime?
  isCompleted      Boolean        @default(false)
  month            Int            @default(1)
  housingCompanyId String
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])
}

model StrategicGoal {
  id               String         @id @default(cuid())
  title            String
  targetValue      Float?
  currentValue     Float?
  unit             String?
  status           GoalStatus     @default(IN_PROGRESS)
  targetDate       DateTime?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  housingCompanyId String
  housingCompany   HousingCompany @relation(fields: [housingCompanyId], references: [id])
}

model BuildingComponent {
  id                String             @id @default(cuid())
  meshId            String             @unique
  name              String
  type              String
  responsibility    ResponsibilityType
  housingCompanyId  String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  estimatedCostSqm  Float?
  expectedLifespan  Int?
  lastRenovatedYear Int?
  housingCompany    HousingCompany     @relation(fields: [housingCompanyId], references: [id])

  @@index([housingCompanyId])
  @@map("building_components")
}

model Expert {
  id          String    @id @default(cuid())
  name        String
  category    String
  description String?
  rating      Float     @default(0)
  hourlyRate  Float     @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  email       String    @unique
  verified    Boolean   @default(false)
  services    Service[]
  users       User[]

  @@map("experts")
}

model Service {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Float
  expertId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  unit        String
  expert      Expert   @relation(fields: [expertId], references: [id])

  @@map("services")
}

model StripeTransaction {
  id             String   @id @default(cuid())
  amount         Float
  status         String
  createdAt      DateTime @default(now())
  currency       String
  orderId        String   @unique
  platformFee    Float
  stripeChargeId String
  updatedAt      DateTime @updatedAt
  order          Order    @relation(fields: [orderId], references: [id])

  @@map("stripe_transactions")
}

enum UserRole {
  RESIDENT
  BOARD_MEMBER
  EXPERT
  ADMIN
}

enum SubscriptionPlan {
  BASIC
  PRO
  PREMIUM
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  PAST_DUE
}

enum OrderType {
  CERTIFICATE
  MODULE_UNLOCK
  SUBSCRIPTION
  EXPERT_SERVICE
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum TicketType {
  MAINTENANCE
  RENOVATION
}

enum TicketCategory {
  MAINTENANCE
  PROJECT
}

enum TriageLevel {
  ROUTINE
  ESCALATED
  CRITICAL
}

enum RenovationStatus {
  COMPLETED
  PLANNED
  PENDING
}

enum RenovationCategory {
  LVI
  ELECTRICAL
  STRUCTURAL
  SURFACE
}

enum RenovationTriageStatus {
  PENDING
  REQUIRES_EXPERT
  AUTO_APPROVE_READY
  APPROVED
  REJECTED
}

enum ObservationStatus {
  OPEN
  REVIEWED
  CLOSED
}

enum BudgetCategory {
  HEATING
  WATER
  ADMIN
  MAINTENANCE
  CLEANING
}

enum InvoiceStatus {
  PENDING
  APPROVED
  PAID
  REJECTED
}

enum InvestmentType {
  SOLAR
  GSHP
  LTO
  HYBRID
}

enum ProjectStatus {
  DIAGNOSIS
  ROI_ANALYSIS
  TENDERING
  TECH_LEAD
  CONSTRUCTION
  WARRANTY
  COMPLETED
  PLANNING
  EXECUTION
}

enum ProjectType {
  WINDOWS
  ROOF
  HEATING
  PLUMBING
  FACADE
  OTHER
}

enum SignatureStatus {
  PENDING
  SIGNED
}

enum UpdateType {
  INFO
  ALERT
  PHOTO
}

enum PollType {
  VOTE
  FEEDBACK
}

enum TenderType {
  SUPERVISOR
  CONSTRUCTION
}

enum TenderStatus {
  OPEN
  REVIEW
  CLOSED
}

enum BidStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum ChangeOrderStatus {
  PENDING
  APPROVED
  REJECTED
}

enum DocumentType {
  CERTIFICATE
  ARTICLES
  STATEMENTS
}

enum OrderStatus {
  PENDING
  PAID
  DELIVERED
}

enum GovernanceStatus {
  DRAFT
  OPEN_FOR_SUPPORT
  QUALIFIED
  VOTING
  APPROVED
  REJECTED
}

enum VoteChoice {
  YES
  NO
  ABSTAIN
}

enum MeetingType {
  GENERAL
  BOARD
}

enum MeterType {
  WATER_HOT
  WATER_COLD
  ELECTRICITY
}

enum LeakSeverity {
  LOW
  MEDIUM
  HIGH
}

enum LeakStatus {
  ACTIVE
  RESOLVED
  IGNORED
}

enum LeakTrigger {
  SENTINEL
  GUARDIAN
  DEFENDER
}

enum PartnerCategory {
  PLUMBER
  ELECTRICIAN
  CLEANER
  LANDSCAPER
  LOCKSMITH
  OTHER
}

enum ResidentTaskStatus {
  OPEN
  IN_PROGRESS
  REVIEW
  COMPLETED
}

enum RewardType {
  HOITOVASTIKE_CREDIT
  CASH
}

enum ResourceType {
  SAUNA
  LAUNDRY
  CLUB_ROOM
  BBQ
  PARKING_GUEST
}

enum PaymentType {
  EURO
  KARMA
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum ContractStatus {
  DRAFT
  SIGNING
  ACTIVE
  COMPLETED
  TERMINATED
}

enum MilestoneStatus {
  PENDING
  PAID
}

enum LoanStatus {
  DRAFT
  ANALYSIS
  APPROVED
  REJECTED
  SUBMITTED
  OFFER_RECEIVED
  ACTIVE
}

enum FiscalQuarter {
  Q1
  Q2
  Q3
  Q4
}

enum TaskCategory {
  GOVERNANCE
  MAINTENANCE
  FINANCE
  LEGAL
}

enum GoalStatus {
  IN_PROGRESS
  ACHIEVED
  DELAYED
  CRITICAL
}

enum ResponsibilityType {
  COMPANY
  SHAREHOLDER
  HYBRID
}
